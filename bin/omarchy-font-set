#!/bin/bash

font_name="$1"


# Detect software-only mode
if [[ -f "$HOME/.local/state/omarchy/software-only.mode" ]]; then
  OMARCHY_SOFTWARE_ONLY=1
else
  OMARCHY_SOFTWARE_ONLY=0
fi

if [[ -n "$font_name" && "$font_name" != "CNCLD" ]]; then
  if fc-list | grep -iq "$font_name"; then
    sed -i "s/family = \".*\"/family = \"$font_name\"/g" ~/.config/alacritty/alacritty.toml
    xmlstarlet ed -L \
      -u '//match[@target="pattern"][test/string="monospace"]/edit[@name="family"]/string' \
      -v "$font_name" \
      ~/.config/fontconfig/fonts.conf

    if [[ $OMARCHY_SOFTWARE_ONLY -eq 0 ]]; then
      # Only update Waybar/SwayOSD configs and restart if not in software-only mode
      sed -i "s/font-family: .*/font-family: $font_name;/g" ~/.config/waybar/style.css
      sed -i "s/font-family: .*/font-family: $font_name;/g" ~/.config/swayosd/style.css
      ~/.local/share/omarchy/bin/omarchy-restart-waybar
      ~/.local/share/omarchy/bin/omarchy-restart-swayosd
    fi
  else
    echo "Font '$font_name' not found."
    exit 1
  fi
else
  echo "Usage: omarchy-font-set <font-name>"
fi
